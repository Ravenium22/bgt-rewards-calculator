<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BGT Gauge Comparison</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js" crossorigin="anonymous"></script>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 p-6">
    <div class="max-w-6xl mx-auto bg-white p-8 rounded-xl shadow-xl">
        <h1 class="text-3xl font-bold mb-8">BGT Gauge Comparison</h1>
        
        <div id="status" class="mb-4 p-4 bg-yellow-50 rounded-lg text-yellow-700">
            Loading gauge data...
        </div>

        <!-- Calculator Section -->
        <div class="mb-8 p-6 bg-blue-50 rounded-xl">
            <h2 class="text-xl font-bold mb-4">Deposit Calculator</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Select Gauge</label>
                    <select id="gaugeSelect" class="w-full p-2 rounded border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                        <option value="">Select a gauge...</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">BERA Amount</label>
                    <input type="number" id="beraAmount" placeholder="Enter BERA amount..." 
                           class="w-full p-2 rounded border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                </div>
            </div>
            <div id="calculationResult" class="mt-4 p-4 bg-white rounded-lg hidden">
                <!-- Results will be shown here -->
            </div>
        </div>

        <!-- Whitelisted Gauges Section -->
        <div class="mb-8">
            <h2 class="text-xl font-bold mb-4">All Whitelisted Gauges</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="gauges-container">
                <!-- Gauge cards will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // All available gauges
        const GAUGES = {
            'LBGT-WBERA': {
                stakingToken: '0x6AcBBedEcD914dE8295428B4Ee51626a1908bB12',
                rewardVault: '0x7a6b92457e7D7e7a5C1A2245488b850B7Da8E01D'
            },
            'YEET-WBERA': {
                stakingToken: '0xE5A2ab5D2fb268E5fF43A5564e44c3309609aFF9',
                rewardVault: '0x175e2429bCb92643255abCbCDF47Fff63F7990CC'
            },
            'TTERP': {
                stakingToken: '0xb18CEC4160E5310e79AEf0d06a8df223A35599cD',
                rewardVault: '0xC4f202b367FCB32F16305bd445E6AB4b445cb738'
            },
            'BRLY-ST': {
                stakingToken: '0xE578502Aa99Bc89CD07E70c995e1AF89D5A129d5',
                rewardVault: '0x6F2f268B8D7A47FFa5e40177A353e3fC2cfe10C8'
            },
            'VDHONEY': {
                stakingToken: '0x1339503343be5626B40Ee3Aee12a4DF50Aa4C0B9',
                rewardVault: '0x2E8410239bB4b099EE2d5683e3EF9d6f04E321CC'
            },
            'BHONEY': {
                stakingToken: '0x1306D3c36eC7E38dd2c128fBe3097C2C2449af64',
                rewardVault: '0xC5Cb3459723B828B3974f7E58899249C2be3B33d'
            },
            'HONEY-WBERA': {
                stakingToken: '0xd28d852cbcc68DCEC922f6d5C7a8185dBaa104B7',
                rewardVault: '0xAD57d7d39a487C04a44D3522b910421888Fb9C6d'
            },
            'PAW-HONEY': {
                stakingToken: '0xa51afAF359d044F8e56fE74B9575f23142cD4B76',
                rewardVault: '0x1992b26E2617928966B4F8e8eeCF41C6e7A77010'
            }
        };

        async function getTokenPrice(tokenAddress) {
            try {
                const response = await fetch(`https://bartio.api.oogabooga.io/v1/tokens/${tokenAddress}/price`);
                const data = await response.json();
                return data.price;
            } catch (error) {
                console.error('Error fetching price:', error);
                return 0;
            }
        }

        function populateGaugeSelect() {
            const select = document.getElementById('gaugeSelect');
            Object.keys(GAUGES).forEach(gaugeName => {
                const option = document.createElement('option');
                option.value = gaugeName;
                option.textContent = gaugeName;
                select.appendChild(option);
            });
        }

        async function calculateDeposit() {
            const gaugeSelect = document.getElementById('gaugeSelect');
            const beraAmount = document.getElementById('beraAmount');
            const resultDiv = document.getElementById('calculationResult');

            if (!gaugeSelect.value || !beraAmount.value) {
                resultDiv.innerHTML = '<p class="text-red-500">Please select a gauge and enter BERA amount</p>';
                resultDiv.classList.remove('hidden');
                return;
            }

            const selectedGauge = GAUGES[gaugeSelect.value];
            try {
                const tokenPrice = await getTokenPrice(selectedGauge.stakingToken);
                const lpAmount = Number(beraAmount.value) / tokenPrice;

                resultDiv.innerHTML = `
                    <div class="space-y-2">
                        <p class="font-medium">Deposit Summary for ${gaugeSelect.value}:</p>
                        <p>BERA Amount: ${Number(beraAmount.value).toLocaleString()} BERA</p>
                        <p>Estimated LP Tokens: ${lpAmount.toLocaleString()} LP</p>
                        <button onclick="window.open('https://bartio.beratrail.io/address/${selectedGauge.stakingToken}', '_blank')" 
                                class="mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                            View Token on Explorer
                        </button>
                    </div>
                `;
                resultDiv.classList.remove('hidden');
            } catch (error) {
                resultDiv.innerHTML = `<p class="text-red-500">Error calculating deposit: ${error.message}</p>`;
                resultDiv.classList.remove('hidden');
            }
        }

        async function getGaugeData(provider, name, addresses) {
            try {
                const vault = new ethers.Contract(addresses.rewardVault, [
                    "function totalSupply() external view returns (uint256)"
                ], provider);
                const totalStaked = await vault.totalSupply();
                const tokenPrice = await getTokenPrice(addresses.stakingToken);
                
                const tvl = Number(ethers.formatEther(totalStaked)) * tokenPrice;
                
                return `
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold mb-4">${name}</h3>
                        <div class="space-y-3">
                            <div>
                                <p class="text-sm text-gray-600">Total Value Locked</p>
                                <p class="text-lg font-bold">$${tvl.toLocaleString(undefined, { maximumFractionDigits: 2 })}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Total Staked LP</p>
                                <p class="text-lg">${Number(ethers.formatEther(totalStaked)).toLocaleString()} LP</p>
                            </div>
                            <button onclick="selectGauge('${name}')" 
                                    class="mt-4 w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                                Select Gauge
                            </button>
                        </div>
                    </div>
                `;
            } catch (error) {
                return `
                    <div class="bg-red-50 p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold mb-4">${name}</h3>
                        <p class="text-red-500">Error loading data: ${error.message}</p>
                    </div>
                `;
            }
        }

        function selectGauge(gaugeName) {
            document.getElementById('gaugeSelect').value = gaugeName;
            document.getElementById('beraAmount').focus();
            document.getElementById('calculationResult').classList.add('hidden');
        }

        async function initializeApp() {
            try {
                const provider = new ethers.JsonRpcProvider('https://bartio.rpc.berachain.com/');
                const container = document.getElementById('gauges-container');
                const statusDiv = document.getElementById('status');
                
                // Populate gauge select
                populateGaugeSelect();

                // Add event listeners
                document.getElementById('gaugeSelect').addEventListener('change', () => {
                    document.getElementById('calculationResult').classList.add('hidden');
                });
                document.getElementById('beraAmount').addEventListener('input', calculateDeposit);

                statusDiv.innerHTML = 'Connected to Berachain. Loading gauge data...';
                statusDiv.className = 'mb-4 p-4 bg-blue-50 rounded-lg text-blue-700';

                const gaugePromises = Object.entries(GAUGES).map(([name, addresses]) => 
                    getGaugeData(provider, name, addresses)
                );

                const gaugeCards = await Promise.all(gaugePromises);
                container.innerHTML = gaugeCards.join('');

                statusDiv.innerHTML = 'Data loaded successfully';
                statusDiv.className = 'mb-4 p-4 bg-green-50 rounded-lg text-green-700';

            } catch (error) {
                console.error('Initialization error:', error);
                document.getElementById('status').innerHTML = 'Error loading data: ' + error.message;
                document.getElementById('status').className = 'mb-4 p-4 bg-red-50 rounded-lg text-red-700';
            }
        }

        // Initialize when ethers is loaded
        window.addEventListener('load', function() {
            if (typeof ethers === 'undefined') {
                document.getElementById('status').innerHTML = 'Error: ethers library not loaded. Please refresh the page.';
                document.getElementById('status').className = 'mb-4 p-4 bg-red-50 rounded-lg text-red-700';
                return;
            }
            initializeApp().catch(console.error);
        });
    </script>
</body>
</html>
